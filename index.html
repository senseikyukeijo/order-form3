<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>先生ミニショップ</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .form-group { margin-bottom: 10px; }
    img { width: 100px; margin: 10px 0; }
    button { padding: 8px 16px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>注文フォーム</h2>
  <div class="form-group">
    <label>商品名: <input type="text" id="item" value="黒ボールペン"></label>
  </div>
  <div class="form-group">
    <label>数量: <input type="number" id="qty" value="1" min="1"></label>
  </div>
  <div class="form-group">
    <label>単価: <input type="number" id="price" value="100" min="0"></label>
  </div>

  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Ballpoint_pen_%28blue%29.jpg/320px-Ballpoint_pen_%28blue%29.jpg" alt="黒ボールペン">

  <button onclick="sendOrder()">注文を確定する</button>

  <script>
    // ★ ここに自分の GAS WebアプリのURLを入れてください（最後は /exec）
    const GAS_URL = "https://script.google.com/a/macros/ict.shimanet.ed.jp/s/AKfycbzv8NtuGUy4Co_dgosZj5TxaPxjEd7ekxrR2_hZWU6PQygaHmwc4gX8Apdfo9B0loVv/exec";

    async function sendOrder() {
      const item = document.getElementById("item").value;
      const qty = parseInt(document.getElementById("qty").value, 10);
      const price = parseInt(document.getElementById("price").value, 10);

      const orderData = {
        total: qty * price,
        items: [
          { name: item, qty: qty, price: price }
        ]
      };

      try {
        const res = await fetch(GAS_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(orderData)
        });

        // 返り値がJSONの場合のみ処理
        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          throw new Error("サーバーからの応答が不正です: " + text);
        }

        if (data.result === "success") {
          alert("注文を確定しました！");
        } else {
          alert("エラー: " + (data.message || "注文できませんでした"));
        }
      } catch (err) {
        console.error(err);
        alert("通信エラー: " + err.message);
      }
    }
  </script>
</body>
</html>
