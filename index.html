<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ˆç”ŸãƒŸãƒ‹ã‚·ãƒ§ãƒƒãƒ—</title>
<style>
  body { font-family: "Segoe UI", sans-serif; background: #f7f9fc; margin: 0; padding: 20px; }
  h1 { text-align: center; color: #333; }
  .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
  .card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
  .card img { width: 80px; height: 80px; object-fit: contain; margin-bottom: 10px; }
  .card button { background: #4CAF50; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; margin-top: 5px; }
  .card button:hover { background: #45a049; }
  #cart { margin-top: 30px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  #cart table { width: 100%; border-collapse: collapse; }
  #cart th, #cart td { padding: 8px; border-bottom: 1px solid #ddd; text-align: center; }
  #total { text-align: right; font-size: 18px; font-weight: bold; margin-top: 10px; }
  #buyerName { padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
</style>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<h1>å…ˆç”ŸãƒŸãƒ‹ã‚·ãƒ§ãƒƒãƒ—</h1>

<!-- å•†å“ä¸€è¦§ -->
<div class="products" id="productList"></div>

<!-- ã‚«ãƒ¼ãƒˆ -->
<div id="cart">
  <h2>ğŸ›’ æ³¨æ–‡ã‚«ãƒ¼ãƒˆ</h2>
  <p>æ³¨æ–‡è€…å: <input type="text" id="buyerName" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></p>
  <table id="cartTable">
    <thead>
      <tr><th>å•†å“</th><th>æ•°é‡</th><th>ä¾¡æ ¼</th><th>å°è¨ˆ</th><th>å‰Šé™¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="total">åˆè¨ˆ: 0å††</p>
  <button onclick="submitOrder()">æ³¨æ–‡ã‚’ç¢ºå®šã™ã‚‹</button>
</div>

<script>
let cart = [];
let products = [
  { name: "èµ¤ãƒšãƒ³", price: 100, img: "https://img.icons8.com/color/96/pen.png" },
  { name: "é»’ãƒœãƒ¼ãƒ«ãƒšãƒ³", price: 120, img: "https://img.icons8.com/ios-filled/100/000000/ball-point-pen.png" },
  { name: "é’ãƒœãƒ¼ãƒ«ãƒšãƒ³", price: 120, img: "https://img.icons8.com/color/96/pen.png" },
  { name: "ã‚³ãƒ¼ãƒ’ãƒ¼", price: 150, img: "https://img.icons8.com/color/96/coffee.png" },
  { name: "æ°´", price: 100, img: "https://img.icons8.com/color/96/water-bottle.png" }
];

// å•†å“ã‚«ãƒ¼ãƒ‰ã‚’æç”»
function renderProducts() {
  const container = document.getElementById("productList");
  container.innerHTML = "";
  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price}å††</p>
      <button onclick="addToCart('${p.name}', ${p.price})">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
    `;
    container.appendChild(card);
  });
}

// ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
function addToCart(name, price) {
  const item = cart.find(i => i.name === name);
  if(item) item.qty++;
  else cart.push({ name, price, qty: 1 });
  renderCart();
}

// ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
function removeFromCart(name) {
  cart = cart.filter(i => i.name !== name);
  renderCart();
}

// æ•°é‡æ›´æ–°
function updateQty(name, qty) {
  const item = cart.find(i => i.name === name);
  if(item) item.qty = qty > 0 ? parseInt(qty,10) : 1;
  renderCart();
}

// ã‚«ãƒ¼ãƒˆæç”»
function renderCart() {
  const tbody = document.querySelector("#cartTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  cart.forEach(item => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td><input type="number" value="${item.qty}" min="1" onchange="updateQty('${item.name}', this.value)"></td>
        <td>${item.price}å††</td>
        <td>${subtotal}å††</td>
        <td><button onclick="removeFromCart('${item.name}')">å‰Šé™¤</button></td>
      </tr>
    `;
  });
  document.getElementById("total").innerText = "åˆè¨ˆ: " + total + "å††";
}

// LIFFåˆæœŸåŒ–ï¼ˆå¿…è¦ãªã‚‰ï¼‰
async function initLiff() {
  try {
    await liff.init({ liffId: "YOUR_LIFF_ID" });
    if(!liff.isLoggedIn()) liff.login();
  } catch(e) {
    console.log("LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", e);
  }
}

// æ³¨æ–‡ç¢ºå®š
async function submitOrder(){
  const buyerName = document.getElementById("buyerName").value.trim();
  if(!buyerName){ alert("æ³¨æ–‡è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  if(cart.length===0){ alert("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™"); return; }

  const total = cart.reduce((sum,i)=>sum+i.price*i.qty,0);
  const orderData = { buyerName, items: cart, total };

  try{
    const response = await fetch("https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec", {
      method: "POST",
      body: JSON.stringify(orderData),
      headers: { "Content-Type": "application/json" }
    });
    const result = await response.json();
    if(result.result==="success"){
      alert("æ³¨æ–‡ãŒç¢ºå®šã—ã¾ã—ãŸï¼");
      cart=[];
      renderCart();
    } else {
      alert("ã‚¨ãƒ©ãƒ¼: "+result.message);
    }
  } catch(err){
    alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼: "+err);
  }
}

// åˆæœŸåŒ–
window.onload = function() {
  renderProducts();
  initLiff();
};
</script>
</body>
</html>
