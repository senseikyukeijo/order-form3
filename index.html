<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>先生ミニショップ</title>
<style>
  body { font-family: "Segoe UI", sans-serif; background: #f7f9fc; margin: 0; padding: 20px; }
  h1 { text-align: center; color: #333; }
  .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
  .card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
  .card img { width: 80px; height: 80px; object-fit: contain; margin-bottom: 10px; }
  .card button { background: #4CAF50; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; margin-top: 5px; }
  .card button:hover { background: #45a049; }
  #cart { margin-top: 30px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  #cart table { width: 100%; border-collapse: collapse; }
  #cart th, #cart td { padding: 8px; border-bottom: 1px solid #ddd; text-align: center; }
  #total { text-align: right; font-size: 18px; font-weight: bold; margin-top: 10px; }
  #buyerName { padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
</style>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<h1>先生ミニショップ</h1>

<!-- 商品一覧 -->
<div class="products" id="productList"></div>

<!-- カート -->
<div id="cart">
  <h2>🛒 注文カート</h2>
  <p>注文者名: <input type="text" id="buyerName" placeholder="名前を入力してください"></p>
  <table id="cartTable">
    <thead>
      <tr><th>商品</th><th>数量</th><th>価格</th><th>小計</th><th>削除</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="total">合計: 0円</p>
  <button onclick="submitOrder()">注文を確定する</button>
</div>

<script>
let cart = [];
let products = [
  { name: "赤ペン", price: 100, img: "https://img.icons8.com/color/96/pen.png" },
  { name: "黒ボールペン", price: 120, img: "https://img.icons8.com/ios-filled/100/000000/ball-point-pen.png" },
  { name: "青ボールペン", price: 120, img: "https://img.icons8.com/color/96/pen.png" },
  { name: "コーヒー", price: 150, img: "https://img.icons8.com/color/96/coffee.png" },
  { name: "水", price: 100, img: "https://img.icons8.com/color/96/water-bottle.png" }
];

// 商品カードを描画
function renderProducts() {
  const container = document.getElementById("productList");
  container.innerHTML = "";
  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price}円</p>
      <button onclick="addToCart('${p.name}', ${p.price})">カートに追加</button>
    `;
    container.appendChild(card);
  });
}

// カートに追加
function addToCart(name, price) {
  const item = cart.find(i => i.name === name);
  if(item) item.qty++;
  else cart.push({ name, price, qty: 1 });
  renderCart();
}

// カートから削除
function removeFromCart(name) {
  cart = cart.filter(i => i.name !== name);
  renderCart();
}

// 数量更新
function updateQty(name, qty) {
  const item = cart.find(i => i.name === name);
  if(item) item.qty = qty > 0 ? parseInt(qty,10) : 1;
  renderCart();
}

// カート描画
function renderCart() {
  const tbody = document.querySelector("#cartTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  cart.forEach(item => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td><input type="number" value="${item.qty}" min="1" onchange="updateQty('${item.name}', this.value)"></td>
        <td>${item.price}円</td>
        <td>${subtotal}円</td>
        <td><button onclick="removeFromCart('${item.name}')">削除</button></td>
      </tr>
    `;
  });
  document.getElementById("total").innerText = "合計: " + total + "円";
}

// LIFF初期化（必要なら）
async function initLiff() {
  try {
    await liff.init({ liffId: "YOUR_LIFF_ID" });
    if(!liff.isLoggedIn()) liff.login();
  } catch(e) {
    console.log("LIFF初期化エラー:", e);
  }
}

// 注文確定
async function submitOrder(){
  const buyerName = document.getElementById("buyerName").value.trim();
  if(!buyerName){ alert("注文者名を入力してください"); return; }
  if(cart.length===0){ alert("カートが空です"); return; }

  const total = cart.reduce((sum,i)=>sum+i.price*i.qty,0);
  const orderData = { buyerName, items: cart, total };

  try{
    const response = await fetch("https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec", {
      method: "POST",
      body: JSON.stringify(orderData),
      headers: { "Content-Type": "application/json" }
    });
    const result = await response.json();
    if(result.result==="success"){
      alert("注文が確定しました！");
      cart=[];
      renderCart();
    } else {
      alert("エラー: "+result.message);
    }
  } catch(err){
    alert("通信エラー: "+err);
  }
}

// 初期化
window.onload = function() {
  renderProducts();
  initLiff();
};
</script>
</body>
</html>
