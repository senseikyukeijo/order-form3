<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å…ˆç”Ÿå‘ã‘ãƒŸãƒ‹ã‚·ãƒ§ãƒƒãƒ—ï¼ˆLIFFï¼‰</title>
  <meta name="color-scheme" content="light dark" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:system-ui, sans-serif;margin:0;padding:0;background:#f5f5f5;color:#333}
    .wrap{max-width:900px;margin:0 auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:14px;box-shadow:0 2px 4px rgba(0,0,0,0.08)}
    .card .img{width:64px;height:64px;border-radius:10px;display:grid;place-items:center;font-size:32px;background:#f0f0f0;margin-bottom:8px}
    .title{font-weight:700;margin:0 0 6px 0}
    .price{font-weight:700;color:#0070f3}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:6px}
    .btn{background:#0070f3;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:600;cursor:pointer}
    .side{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px;margin-top:20px}
    .line{display:flex;gap:10px;align-items:center;margin-bottom:10px}
    .qty{display:flex;align-items:center;border:1px solid #ccc;border-radius:6px}
    .qty button{background:transparent;border:none;padding:4px 8px;cursor:pointer}
    .qty input{width:40px;border:none;text-align:center}
    .total{font-size:18px;font-weight:800}
    .hidden{display:none}
    select{padding:4px;border-radius:6px;border:1px solid #ccc}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>å…ˆç”ŸãƒŸãƒ‹ã‚·ãƒ§ãƒƒãƒ—</h1>

    <!-- å•†å“é¸æŠç”»é¢ -->
    <div id="catalogScreen">
      <h2>å•†å“ã‚’é¸ã¶</h2>
      <div class="grid" id="catalog"></div>
      <button class="btn" id="goCart">ã‚«ãƒ¼ãƒˆã‚’è¦‹ã‚‹</button>
    </div>

    <!-- æ³¨æ–‡ç¢ºèªç”»é¢ -->
    <div id="cartScreen" class="hidden">
      <h2>æ³¨æ–‡ç¢ºèª</h2>
      <div class="side">
        <div id="cartList"></div>
        <div class="row"><span>å°è¨ˆ:</span><span id="subtotal">Â¥0</span></div>
        <div class="row"><span>ç¨è¾¼:</span><span id="tax">Â¥0</span></div>
        <div class="row total"><span>åˆè¨ˆ:</span><span id="total">Â¥0</span></div>
        <div class="row">
          <button class="btn" id="checkout">æ³¨æ–‡ã™ã‚‹</button>
          <button class="btn" style="background:#555" id="backCatalog">å•†å“ã«æˆ»ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LIFF_ID = "YOUR_LIFF_ID_HERE";
    const ORDER_WEBHOOK_URL = "https://example.com/your-webhook";
    const TAX_RATE = 0.10;

    const PRODUCTS = [
      {id:"P01", name:"èµ¤ãƒšãƒ³ 0.5mmï¼ˆ3æœ¬ï¼‰", price:300, unit:"ã‚»ãƒƒãƒˆ", emoji:"ğŸ–Šï¸"},
      {id:"P02", name:"é»’ãƒœãƒ¼ãƒ«ãƒšãƒ³ 1.0mmï¼ˆ3æœ¬ï¼‰", price:280, unit:"ã‚»ãƒƒãƒˆ", emoji:"âœ’ï¸"},
      {id:"P03", name:"é’ãƒœãƒ¼ãƒ«ãƒšãƒ³ 0.7mmï¼ˆ2æœ¬ï¼‰", price:200, unit:"ã‚»ãƒƒãƒˆ", emoji:"ğŸ–‹ï¸"},
      {id:"P04", name:"ãƒ‰ãƒªãƒƒãƒ—ã‚³ãƒ¼ãƒ’ãƒ¼ï¼ˆ5ãƒ‘ãƒƒã‚¯ï¼‰", price:420, unit:"ç®±", emoji:"â˜•"},
      {id:"P05", name:"ãƒŸãƒãƒ©ãƒ«ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ï¼ˆ500mlï¼‰", price:120, unit:"æœ¬", emoji:"ğŸ’§"}
    ];

    const $ = (s)=>document.querySelector(s);
    const state = { cart: {} };

    function save(){ renderCart(); }
    function money(n){ return "Â¥"+n.toLocaleString("ja-JP"); }
    function addToCart(id,qty){
      const q = parseInt(qty||1);
      state.cart[id] = (state.cart[id]||0)+q;
      save();
      alert(`${q}å€‹ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`);
    }
    function setQty(id,q){ const n=Math.max(0,parseInt(q||0)); if(n===0) delete state.cart[id]; else state.cart[id]=n; save(); }
    function cartItems(){ return Object.entries(state.cart).map(([id,qty])=>{ const p=PRODUCTS.find(x=>x.id===id); return {...p, qty}; }); }
    function totals(){ const sub=cartItems().reduce((a,b)=>a+b.price*b.qty,0); const tax=Math.round(sub*TAX_RATE); return {sub,tax,total:sub+tax}; }

    function renderCatalog(){
      $('#catalog').innerHTML = PRODUCTS.map(p=>{
        const options = Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('');
        return `
        <div class="card">
          <div class="img">${p.emoji}</div>
          <p class="title">${p.name}</p>
          <p class="price">${money(p.price)}</p>
          <div class="row">
            <label>æ•°é‡:</label>
            <select id="qty_${p.id}">${options}</select>
          </div>
          <button class="btn" onclick="addToCart('${p.id}', document.getElementById('qty_${p.id}').value)">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
        </div>`;
      }).join('');
    }

    function renderCart(){
      const list=cartItems();
      const area=$('#cartList');
      if(list.length===0){ area.innerHTML='<p>ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>'; }
      else {
        area.innerHTML=list.map(i=>`
          <div class="line">
            <div class="img" style="width:32px;height:32px">${i.emoji}</div>
            <div style="flex:1">
              <strong>${i.name}</strong><br>
              ${money(i.price)} Ã—
              <div class="qty">
                <button onclick="setQty('${i.id}', (state.cart['${i.id}']||0)-1)">ï¼</button>
                <input value="${i.qty}" oninput="setQty('${i.id}',this.value)">
                <button onclick="setQty('${i.id}', (state.cart['${i.id}']||0)+1)">ï¼‹</button>
              </div>
            </div>
          </div>`).join('');
      }
      const t=totals();
      $('#subtotal').textContent=money(t.sub);
      $('#tax').textContent=money(t.tax);
      $('#total').textContent=money(t.total);
    }

    async function submitOrder(){
      const items=cartItems(); if(items.length===0){alert('ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™'); return;}
      const t=totals();
      const order={timestamp:new Date().toISOString(),items,subtotal:t.sub,tax:t.tax,total:t.total};
      try{ await fetch(ORDER_WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(order)}); alert('æ³¨æ–‡ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ'); state.cart={}; save(); showCatalog(); }
      catch(e){ alert('æ³¨æ–‡é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
    }

    function showCatalog(){ $('#catalogScreen').classList.remove('hidden'); $('#cartScreen').classList.add('hidden'); }
    function showCart(){ renderCart(); $('#catalogScreen').classList.add('hidden'); $('#cartScreen').classList.remove('hidden'); }

    document.addEventListener('DOMContentLoaded',()=>{
      renderCatalog(); renderCart();
      $('#checkout').addEventListener('click', submitOrder);
      $('#goCart').addEventListener('click', showCart);
      $('#backCatalog').addEventListener('click', showCatalog);
    });
  </script>
</body>
</html>

